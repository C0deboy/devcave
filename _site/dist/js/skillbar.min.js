'use strict';

(function () {
  var skillbars = document.querySelectorAll('.skillbar');

  skillbars.forEach(function (skillbar) {
    var waypoint = new Waypoint({
      element: skillbar,
      handler: function handler() {
        makeProgressBar(skillbar);
        this.destroy();
      },

      offset: '80%'
    });
  });

  function makeProgressBar(skillbar) {
    var percentage = parseInt(skillbar.getAttribute('data-pct'));
    var pctCountEl = document.createElement('span');
    var i = 0;
    var countingPct = setInterval(function () {
      pctCountEl.innerText = i + '%';
      if (i === percentage) {
        clearInterval(countingPct);
      }
      i++;
    }, 20);

    var progressBar = document.createElement('div');
    progressBar.classList.add('skillbar-progress');

    skillbar.appendChild(progressBar);
    progressBar.style.width = (skillbar.clientWidth - 130) * (percentage * 0.01) + 'px';
    progressBar.style.backgroundColor = progressBar.previousElementSibling.style.backgroundColor;

    skillbar.appendChild(pctCountEl);
  }
})();
