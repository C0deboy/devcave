<!DOCTYPE html>
<html lang="pl">
<head>
  
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Devcave - blog programisty na tematy związane z branżą IT, a szczególnie z programowaniem. Pracuję głownie z językami Java i Javascript, ale na blogu nie zabraknie tematów ogólnych ;)">
<meta name="author" content="Codeboy">

<meta property="fb:pages" content="2221389098088691">
<meta property="og:title" content="Dodajemy formularz kontaktowy 3#">
<meta property="og:description" content="Walidacja PHP + Swiftmailer">

<title>Formularz kontaktowy-walidacja-php-swiftmailer</title>

<link rel="canonical" href="https://devcave.pl/dajsiepoznac2017/formularz-kontaktowy-php-swiftmailer">
<link rel="shortcut icon" href="/img/logo.ico">

<link rel="stylesheet" href="/dist/css/devcave.min.css">

<link href="//fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,800' rel='stylesheet' type='text/css'>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link type="application/atom+xml" rel="alternate" href="https://devcave.pl/feed.xml" title="devcave.pl" />

</head>

<body>

<div class="navbar navbar-expand-lg navbar-light navbar-fixed-top navbar-custom">

    <a class="navbar-brand" href="/"><img src="/img/devcave.png" alt="logo"> devcave.pl</a>

    <button type="button" id="navbar-toggle-btn" class="navbar-toggler" data-toggle="collapse"
            data-target="#site-nav" aria-expanded="false" aria-controls="site-nav">

        Menu <i class="fa fa-bars" aria-hidden="true"></i>
    </button>

    <nav id="site-nav" class="collapse navbar-collapse">
        <ul class="nav navbar-nav ml-auto text-right">
            <li class="nav-item">
                <a class="nav-link" href="/o-mnie/">O mnie</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="/archiwum/">Archiwum</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="/kontakt/">Kontakt</a>
            </li>
            <li class="nav-item">
                <a class="nav-link books-btn" href="/moja-biblioteka">Moja biblioteka</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/moje-projekty">Moje projekty</a>
            </li>
            <li class="nav-item">
                <button class="dark-mode-btn nav-link" data-toggle="tooltip" data-placement="bottom"
                        title="Zmień motyw">
                    <i class="fa fa-sun-o" aria-hidden="true"></i>/<i class="fa fa-moon-o" aria-hidden="true"></i>
                </button>
            </li>
        </ul>
    </nav>
</div>


<article>

  <div class="container post">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

        <header class="post-header">
          <div class="post-heading">

            <h1 class="post-title">Dodajemy formularz kontaktowy 3#</h1>
            
            <h2 class="post-subtitle">Walidacja PHP + Swiftmailer</h2>
            
            <p class="post-meta">
              
              26
              marca
              
              2017</p>
            <div class="tags">
              <div class="site-tag"><a href='/archiwum#dajsiepoznac2017'>DajSiePoznac2017</a></div>
              
            </div>

          </div>

          <hr>
        </header>

        
        <nav class="table-of-contents">
          <p class="m-0">Spis treści:</p>
          <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#swiftmailer">Swiftmailer</a>
<ul>
<li class="toc-entry toc-h2"><a href="#co-to-takiego">Co to takiego?</a></li>
<li class="toc-entry toc-h2"><a href="#dlaczego-nie-wbudowany-w-php-mail">Dlaczego nie wbudowany w PHP mail()?</a></li>
<li class="toc-entry toc-h2"><a href="#instalacja-swiftmailer-a">Instalacja Swiftmailer-a</a></li>
<li class="toc-entry toc-h2"><a href="#odbieramy-dane-wysłane-za-pomocą-ajax">Odbieramy dane wysłane za pomocą AJAX</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#walidacja-php">Walidacja PHP</a>
<ul>
<li class="toc-entry toc-h2"><a href="#jak-odebrać-błedy--komunikaty-php-przez-ajax">Jak odebrać błedy / komunikaty PHP przez AJAX?</a></li>
</ul>
</li>
</ul>

          <hr>
        </nav>
        

        <p><u>W tym poście opisuję walidację danych z formularza (przesłanych przez AJAX) po stronie serwera (PHP) oraz tworzenie wiadomości, ustawienie połączenia z serwerem pocztowym oraz wreszcie wysłanie wiadomości.</u></p>

<p>Jeśli trafiłeś tu bezpośrednio, zajrzyj do <a href="/dajsiepoznac2017/formularz-kontaktowy-HTML-JS">pierwszego postu</a>, gdzie opisuję założenia i tworzę podstawową strukturę formularza.</p>

<hX>Wpisy w tej serii:</hX>
<ol>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-HTML-JS">HTML + otwieranie / zamykanie JQuery</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-walidacja-ajax">Walidacja HTML5/JS + AJAX</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-php-swiftmailer">Walidacja PHP + Swiftmailer</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-dostepnosc">Dostępność formularza</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-refaktoryzacja">Zrefaktoryzowana wersja + Github</a></li>
</ol>

<p>W kolejnym poście zajmiemy się poprawą dostępności formularza.</p>

<h1 id="swiftmailer">Swiftmailer</h1>

<h2 id="co-to-takiego">Co to takiego?</h2>

<p><a href="http://swiftmailer.org/">Swiftmailer</a> to biblioteka do wysyłania maili napisana w PHP5.</p>

<h2 id="dlaczego-nie-wbudowany-w-php-mail">Dlaczego nie wbudowany w PHP mail()?</h2>

<p>Funkcja mail() jest już przestarzała i stosowanie jej nie należy do dobrych praktyk. Ponadto maile wysyłane za jego pomocą często trafiają do spamu. Dlatego powinniśmy używać nowszych rozwiązań, jak np. Swiftmailer, które oferują dużo większe możliwości i są bardziej bezpieczne.</p>

<h2 id="instalacja-swiftmailer-a">Instalacja Swiftmailer-a</h2>

<p>Pobieramy paczkę z <a href="https://github.com/swiftmailer/swiftmailer">gita</a> i wrzucamy do folderu z naszą stroną. Tworzymy plik PHP, który będzie obsługiwał wysyłanie maili, w moim przypadku emailform.php, i załączamy pobraną paczkę.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
  <span class="k">require_once</span> <span class="s1">'swiftmailer/lib/swift_required.php'</span><span class="p">;</span>
  <span class="c1">//dalszy kod
</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>I gotowe. Możemy korzystać ze Swiftmailera.
Przygotujmy sobie jeszcze oddzielny plik konfiguracyjny z wrażliwymi danymi, których nie powinniśmy udostępniać. Gdy korzystamy na przykład z systemu kontroli wersji GIT, nie chcemy, aby te dane były umieszczone publicznie w naszym repozytorium.</p>

<p>Niech będzie to plik <span class="file">emailconfig.php</span>. Utworzymy w nim tablicę z danymi, która będzie zwracana do zmiennej:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
  <span class="k">return</span> <span class="p">[</span>
      <span class="s1">'secretKey'</span> <span class="o">=&gt;</span> <span class="s1">'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-XX'</span><span class="p">,</span>
      <span class="s1">'mailServer'</span> <span class="o">=&gt;</span> <span class="s1">'mail.domena.pl'</span><span class="p">,</span>
      <span class="s1">'port'</span>  <span class="o">=&gt;</span> <span class="s1">'587'</span><span class="p">,</span>
      <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'nazwa-konta'</span><span class="p">,</span>
      <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'haslo'</span><span class="p">,</span>
      <span class="s1">'myEmail'</span> <span class="o">=&gt;</span> <span class="s1">'naszemail@domena.pl'</span>
  <span class="p">];</span>
<span class="cp">?&gt;</span></code></pre></figure>

<hX>Gdzie:</hX>

<ul>
  <li><code class="highlight"><span class="s">'secretKey'</span></code> - nasz sekretny klucz do reCAPTCHA</li>
  <li><code class="highlight"><span class="s">'mailServer'</span></code> - nasz serwer pocztowy</li>
  <li><code class="highlight"><span class="s">'port'</span></code> - port dla danej uslugi, w przypdaku SMTP jest to 587.</li>
  <li><code class="highlight"><span class="s">'username'</span></code>, <code class="highlight"><span class="s">'password'</span></code> - nazwa i hasło naszego konta pocztowego.</li>
  <li><code class="highlight"><span class="s">'myEmail'</span></code> - adres email na który mają trafiać wiadomości.</li>
</ul>

<p>Jest to nieco lepszy sposób, gdyż nie zaśmiecamy sobie pliku zwykłymi zmiennymi globalnymi, w przypadku gdybyśmy to zadeklarowali tak:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$secretKey</span> <span class="o">=</span> <span class="s2">"XXX"</span><span class="p">;</span>
 <span class="c1">//itd.</span>
</code></pre></div></div>
<p>Teraz wystarczy dodać nazwę naszego pliku z danymi do <span class="file">.gitignore</span> i będzie on ignorowany przez GIT-a.</p>

<p>Również powiniśmy zablokować dostęp do tego pliku na naszym serwerze. Aby to zrobić wystarczy dodać kilka linijek do pliku <span class="file">.htaccess</span> na naszym serwerze:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&lt;Files emailconfig.php&gt;
order allow,deny
deny from all
&lt;/Files&gt;</code></pre></figure>

<p>Pobieramy i przypisujemy sobie naszą tablicę do zmiennej $config:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$config</span> <span class="o">=</span> <span class="k">require_once</span> <span class="s1">'emailconfig.php'</span><span class="p">;</span>
</code></pre></div></div>

<p>I teraz będziemy mogli uzyskać dostęp do naszych danych w następujący sposób:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$secretKey</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'secretKey'</span><span class="p">];</span>
</code></pre></div></div>

<h2 id="odbieramy-dane-wysłane-za-pomocą-ajax">Odbieramy dane wysłane za pomocą AJAX</h2>

<p>Przechowywane są one w tablicy super globalnej $_POST, tak jak to zdefiniowaliśmy w żądaniu AJAX w parametrze “type”.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$userEmail</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userEmail'</span><span class="p">];</span>
  <span class="nv">$subject</span> <span class="o">=</span> <span class="nb">filter_var</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">],</span> <span class="nx">FILTER_SANITIZE_STRING</span><span class="p">,</span> <span class="nx">FILTER_FLAG_NO_ENCODE_QUOTES</span><span class="p">);</span>
  <span class="nv">$messageText</span> <span class="o">=</span> <span class="nb">filter_var</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'message'</span><span class="p">],</span> <span class="nx">FILTER_SANITIZE_STRING</span><span class="p">,</span> <span class="nx">FILTER_FLAG_NO_ENCODE_QUOTES</span><span class="p">);</span>
</code></pre></div></div>

<hX>Gdzie:</hX>
<ul>
  <li><code class="highlight"><span class="k">filter_var</span></code> -jest to filtr, przez który przepuszczamy zmienne, aby pozbyć się niechcianych znaków. Z filtrem <code class="highlight"><span class="nx">FILTER_SANITIZE_STRING</span></code> usuwane są tagi i znaki specjalne. Flaga <code class="highlight"><span class="nx">FILTER_FLAG_NO_ENCODE_QUOTES</span></code> pomija znaki cudzysłowu.</li>
</ul>

<p>Zanim przejdziemy do walidacji, odbierzmy jeszcze odpowiedź reCAPTCHA i przypiszmy do zmiennej $answear.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$checkIfBot</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'https://www.google.com/recaptcha/api/siteverify?secret='</span><span class="o">.</span><span class="nv">$secretKey</span><span class="o">.</span><span class="s1">'&amp;response='</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'g-recaptcha-response'</span><span class="p">]);</span>
  <span class="nv">$recaptcha</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$checkIfBot</span><span class="p">);</span>
</code></pre></div></div>
<hX>Gdzie:</hX>
<ul>
  <li><code class="highlight"><span class="k">file_get_contents</span>()</code> - ta funkcja zwraca zawartość plików jako string. W naszym przypadku będzie to odpowiedź wygenerowana na podstawie danych w URL, które są przesyłane tak jak metodą GET, o której wspominałem <a href="/dajsiepoznac2017/formularz-kontaktowy-HTML-JS#get-post">wcześniej</a>.</li>
  <li><code class="highlight"><span class="k">json_decode</span>()</code> - dekoduje dane JSON. Dzięki temu będziemy mogli później uzyskać dostęp do odpowiedzi w ten sposób:</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$recaptcha</span><span class="o">-&gt;</span><span class="na">success</span>
</code></pre></div></div>
<h1 id="walidacja-php">Walidacja PHP</h1>

<p>Sprawdzamy poszczególne dane od użytkownika oraz odpowiedź reCAPTCHA i tworzymy zmienną $alert, która będzie przetrzymywać komunikaty:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$userEmail</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_EMAIL</span><span class="p">)){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Podaj poprawny email!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$subject</span><span class="p">)){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Wpisz jakiś temat!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$messageText</span><span class="p">)){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Pusta wiadomość? Napisz coś!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$recaptcha</span><span class="o">-&gt;</span><span class="na">success</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Potwierdź, że nie jesteś robotem!'</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>
<hX>Gdzie:</hX>
<ul>
  <li><code class="highlight"><span class="nx">FILTER_VALIDATE_EMAIL</span></code> - ten filtr sprawdza czy zmienna jest poprawnym adresem email. Jeśli tak zwraca “true”. Zauważ, że przed funkcją jest negacja(!). Jeśli email nie jest podany zwraca “false”, więc nie ma potrzeby sprawdzać tego osobno.</li>
  <li><code class="highlight"><span class="k">empty</span>()</code> - Sprawdza czy wartość jest pusta. Jeśli tak zwraca “true”. Jako puste brane są pod uwagę “”, 0, “0”, null.</li>
</ul>

<p>I możemy wreszcie skonfigurować połączenie za pomocą Swiftmailera, wysłać wiadomość i wyświetlić komunikat w zależności czy się to powiodło czy nie:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$transport</span> <span class="o">=</span> <span class="nx">Swift_SmtpTransport</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'mailServer'</span><span class="p">],</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'port'</span><span class="p">])</span>
      <span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'username'</span><span class="p">])</span>
      <span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])</span>
      <span class="p">;</span>

    <span class="nv">$mailer</span> <span class="o">=</span> <span class="nx">Swift_Mailer</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>

    <span class="nv">$message</span> <span class="o">=</span> <span class="nx">Swift_Message</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$subject</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="nv">$userEmail</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setReplyTo</span><span class="p">(</span><span class="nv">$userEmail</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setTo</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'myEmail'</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$messageText</span><span class="p">)</span>
    <span class="p">;</span>

    <span class="nv">$emailSent</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$emailSent</span><span class="p">){</span>
      <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Wysłano. Dzięki za wiadomość!'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Coś poszło nie tak.'</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>Myślę, że ten kod jest w miarę jasny. Jeśli zastanawiasz się co za co odpowiada odsyłam do <a href="http://swiftmailer.org/docs/introduction.html">dokumentacji</a>.</p>

<h2 id="jak-odebrać-błedy--komunikaty-php-przez-ajax">Jak odebrać błedy / komunikaty PHP przez AJAX?</h2>

<p>Bardzo prosto. Musimy je wcześniej jednak przekonwertować na format JSON, gdyż taki zadeklarowaliśmy w naszym żądaniu AJAX w polu “dataType”. <code class="highlighter-rouge">php?start_inline=1 $response = json_encode(array( 'text' =&gt; $alert ));</code> Pozostało skorzystać z funkcji exit<code class="highlighter-rouge">()</code>, która kończy skrypt i przekazuje naszą odpowiedź: <code class="highlighter-rouge">php?start_inline=1 exit($response);</code></p>

<p>Oto nasz cały kod:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
  <span class="k">require_once</span> <span class="s1">'swiftmailer/lib/swift_required.php'</span><span class="p">;</span>
  <span class="nv">$config</span> <span class="o">=</span> <span class="k">require_once</span> <span class="s1">'emailconfig.php'</span><span class="p">;</span>
  <span class="nv">$secretKey</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'secretKey'</span><span class="p">];</span>

  <span class="nv">$userEmail</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'userEmail'</span><span class="p">];</span>
  <span class="nv">$subject</span><span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">],</span> <span class="nx">FILTER_SANITIZE_STRING</span><span class="p">,</span> <span class="nx">FILTER_FLAG_NO_ENCODE_QUOTES</span><span class="p">);</span>
  <span class="nv">$messageText</span><span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'message'</span><span class="p">],</span> <span class="nx">FILTER_SANITIZE_STRING</span><span class="p">,</span> <span class="nx">FILTER_FLAG_NO_ENCODE_QUOTES</span><span class="p">);</span>

  <span class="nv">$checkIfBot</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'https://www.google.com/recaptcha/api/siteverify?secret='</span><span class="o">.</span><span class="nv">$secretKey</span><span class="o">.</span><span class="s1">'&amp;response='</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'g-recaptcha-response'</span><span class="p">]);</span>
  <span class="nv">$recaptcha</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$checkIfBot</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$userEmail</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_EMAIL</span><span class="p">)){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Podaj poprawny email!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$subject</span><span class="p">)){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Wpisz jakiś temat!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$messageText</span><span class="p">)){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Pusta wiadomość? Napisz coś!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$recaptcha</span><span class="o">-&gt;</span><span class="na">success</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Potwierdź, że nie jesteś robotem!'</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$transport</span> <span class="o">=</span> <span class="nx">Swift_SmtpTransport</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'mailServer'</span><span class="p">],</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'port'</span><span class="p">])</span>
      <span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'username'</span><span class="p">])</span>
      <span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])</span>
      <span class="p">;</span>

    <span class="nv">$mailer</span> <span class="o">=</span> <span class="nx">Swift_Mailer</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>

    <span class="nv">$message</span> <span class="o">=</span> <span class="nx">Swift_Message</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$subject</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="nv">$userEmail</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setReplyTo</span><span class="p">(</span><span class="nv">$userEmail</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setTo</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'myEmail'</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$messageText</span><span class="p">)</span>
    <span class="p">;</span>

    <span class="nv">$emailSent</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$emailSent</span><span class="p">){</span>
      <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Wysłano. Dzięki za wiadomość!'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$alert</span> <span class="o">=</span> <span class="s1">'Coś poszło nie tak.'</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nv">$response</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'text'</span> <span class="o">=&gt;</span> <span class="nv">$alert</span>
  <span class="p">));</span>

  <span class="k">exit</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre></figure>



      </div>
    </div>
  </div>

</article>

<div class="container d-print-none">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <hr>

      <ul class="pagination">
        
        <li class="page-item">
          <a class="page-link box-effect" href="/dajsiepoznac2017/formularz-kontaktowy-walidacja-ajax"
             data-toggle="tooltip" data-animation="zoom" data-delay="50" title="Dodajemy formularz kontaktowy 2#"><i class="fa fa-arrow-left"
                                                                                                            aria-hidden="true"></i>
            Poprzedni post</a>
        </li>
        
        
        <li class="page-item ml-auto">
          <a class="page-link box-effect" href="/dajsiepoznac2017/formularz-kontaktowy-dostepnosc"
             data-toggle="tooltip" data-animation="zoom" data-delay="50" title="Dodajemy formularz kontaktowy 4#">Następny post <i
                  class="fa fa-arrow-right" aria-hidden="true"></i></a>
        </li>
        
      </ul>

      <div class="text-center">
    <p class="text-center">Jeśli uważasz, że to co robię jest przydatne, polub stronę bloga na Facebooku. Wrzucam tam m.in. informacje o nowych wpisach, o promocjach dla programistów i inne.</p>

    <div class="fb-page inline box-effect">
        <iframe
            src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fdevcavepl&tabs&width=340&height=130&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=false&appId"></iframe>
    </div>
</div>

      <div class="recommended">
    <div class="box-effect books-ad ">
        <a href="https://jaki-jezyk-programowania.pl/ksiazki">
            <img src="/img/books.png" alt="książki"/>
            <h3>Zobacz polecane książki</h3>
        </a>
    </div>

    <div class="box-effect books-ad ">
        <a href="https://jaki-jezyk-programowania.pl/kursy">
            <img src="/img/video-courses.png" alt="video kursy"/>
            <h3>Zobacz polecane video kursy</h3>
        </a>
    </div>
</div>

      <hr>

      

<div id="disqus_thread"></div>
<script>
  const disqus_config = function () {
    this.page.url = "https://devcave.pl/dajsiepoznac2017/formularz-kontaktowy-php-swiftmailer";
    this.page.identifier = "/dajsiepoznac2017/formularz-kontaktowy-php-swiftmailer";
  };

  (function () { // DON'T EDIT BELOW THIS LINE
    const d = document, s = d.createElement('script');
    s.src = 'https://jaki-jezyk-programowania.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Włacz JavaScript w twojej przeglądarce, aby zobaczyć <a href="https://disqus.com/?ref_noscript"> komentarze by
    Disqus.</a></noscript>



    </div>
  </div>
</div>

<hr>

<script src="/promotion/promotion.js"></script>



<footer class="d-print-none">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center social-buttons">
                    <li class="list-inline-item">
                        <a class="main-btn" href="/feed.xml" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="RSS">
                            <i class="fa fa-rss fa-lg"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a class="main-btn" href="https://www.linkedin.com/in/marcin-lasota/" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="LinkedIn">
                            <i class="fa fa-linkedin-square" aria-hidden="true"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a class="main-btn" href="https://github.com/C0deboy" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="Github">
                            <i class="fa fa-github fa-lg"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a class="main-btn" href="mailto:lasota.marcinm@gmail.com" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="lasota.marcinm@gmail.com">
                            <i class="fa fa-envelope fa-lg"></i>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright <i class="fa fa-copyright" aria-hidden="true"></i> devcave 2017 - 2019</p>
            </div>
        </div>
    </div>
</footer>

<script src="/dist/js/devcave.min.js"></script>




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90973428-2', 'auto');
  ga('send', 'pageview');

</script>




</body>

</html>
