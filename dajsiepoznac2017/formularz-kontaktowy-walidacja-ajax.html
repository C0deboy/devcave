<!DOCTYPE html>
<html lang="pl">
<head>
  
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Devcave - blog programisty na tematy związane z branżą IT, a szczególnie z programowaniem. Pracuję głownie z językami Java i Javascript, ale na blogu nie zabraknie tematów ogólnych ;)">
<meta name="author" content="Codeboy">

<meta property="fb:pages" content="2221389098088691">

<title>Formularz kontaktowy- walidacja + AJAX</title>

<link rel="canonical" href="https://devcave.pl/dajsiepoznac2017/formularz-kontaktowy-walidacja-ajax">
<link rel="shortcut icon" href="/img/logo.ico">

<link rel="stylesheet" href="/dist/css/devcave.min.css">

<link href="//fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
<link href='//fonts.googleapis.com/css?family=Open+Sans:300,600,800' rel='stylesheet' type='text/css'>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link type="application/atom+xml" rel="alternate" href="https://devcave.pl/feed.xml" title="devcave.pl" />

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-custom">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="/"><img src="/img/devcave.png" alt="logo"> devcave.pl</a>

            <button type="button" id="navbar-toggle-btn" class="navbar-toggle" data-toggle="collapse"
                    data-target="#site-nav" aria-expanded="false" aria-controls="site-nav">

                Menu <i class="fa fa-bars" aria-hidden="true"></i>
            </button>
        </div>

        <nav id="site-nav" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="nav-el" href="/o-mnie/">O mnie</a>
                </li>

                <li>
                    <a class="nav-el" href="/archiwum/">Archiwum</a>
                </li>

                <li>
                    <a class="nav-el" href="/kontakt/">Kontakt</a>
                </li>
                <li>
                    <a class="nav-el books-btn" href="/moja-biblioteka">Moja biblioteka</a>
                </li>
                <li>
                    <a class="nav-el" href="/moje-projekty">Moje projekty</a>
                </li>
                <li>
                    <button class="dark-mode-btn nav-el" data-toggle="tooltip" data-placement="bottom"
                            title="Zmień motyw">
                        <i class="fa fa-sun-o" aria-hidden="true"></i>/<i class="fa fa-moon-o" aria-hidden="true"></i>
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</div>


<article>

  <div class="container post">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

        <header class="post-header">
          <div class="post-heading">

            <h1 class="post-title">Dodajemy formularz kontaktowy 2#</h1>
            
            <h2 class="post-subtitle">Walidacja Javascript + AJAX</h2>
            
            <p class="post-meta">
              
              23
              marca
              
              2017</p>
            
            <div class="site-tag"><a href='/archiwum#dajsiepoznac2017'>DajSiePoznac2017</a></div>
            
          </div>

          <hr>
        </header>

        
        <nav class="table-of-contents">
          <p class="m0">Spis treści:</p>
          <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#walidacja">Walidacja</a>
<ul>
<li class="toc-entry toc-h2"><a href="#dlaczego-zarówno-po-stronie-serwera-jak-i-użytkownika">Dlaczego zarówno po stronie serwera jak i użytkownika?</a></li>
<li class="toc-entry toc-h2"><a href="#walidacja-w-html5-i-javascript">Walidacja w HTML5 i Javascript</a></li>
</ul>
</li>
</ul>

          <hr>
        </nav>
        

        <p><u>W tym poście opisuję walidację formularza po stronie użytkownika (Javascript). Ponadto pokazuję jak za pomocą AJAX, przekazać dane do pliku PHP i odebrać odpowiedź bez przeładowania strony.</u></p>

<p>Jeśli trafiłeś tu bezpośrednio, zajrzyj do <a href="/dajsiepoznac2017/formularz-kontaktowy-HTML-JS">pierwszego postu</a>, gdzie opisuję założenia i tworzę podstawową strukturę formularza.</p>

<p>Wpisy w tej serii:</p>
<ol>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-HTML-JS">HTML + otwieranie / zamykanie JQuery</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-walidacja-ajax">Walidacja HTML5/JS + AJAX</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-php-swiftmailer">Walidacja PHP + Swiftmailer</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-dostepnosc">Dostępność formularza</a></li>
  <li><a href="/dajsiepoznac2017/formularz-kontaktowy-refaktoryzacja">Zrefaktoryzowana wersja + Github</a></li>
</ol>

<p>W kolejnym poście zajmiemy się walidacją po stronie serwera (PHP) oraz wreszcie wysyłaniem wiadomości za pomocą Swiftmailer-a</p>

<h1 id="walidacja">Walidacja</h1>

<h2 id="dlaczego-zarówno-po-stronie-serwera-jak-i-użytkownika">Dlaczego zarówno po stronie serwera jak i użytkownika?</h2>

<p>Samo zweryfikowanie danych po stronie użytkownika nie jest wystarczającym zabezpieczeniem. Możemy łatwo wyłączyć Javascript w przeglądarce i nasza walidacja znika. Dlaczego więc w ogóle ją robić po stronie użytkownika? Ponieważ jest dla niego bardziej przyjazna oraz przeprowadzana jest natychmiast. Nie ma potrzeby czekać na odpowiedź serwera za każdym razem, kiedy pole jest źle wypełnione. Walidacji po stronie serwera nie da się wyłączyć, więc jest to nasza ostatnia linia obrony przed nieprawidłowymi danymi przekazanymi przez użytkownika.</p>

<h2 id="walidacja-w-html5-i-javascript">Walidacja w HTML5 i Javascript</h2>

<p>HTML5 oferuję nam wbudowaną <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5/Constraint_validation">funkcję walidacji</a> formularza, którą możemy także obsłużyć i dowolnie modyfikować za pomocą Javascript-u, i z tego skorzystamy.</p>

<p>Tak więc do naszych pól dodajemy takie właściwości:</p>
<ul>
  <li><code class="highlight"><span class="na">type=</span><span class="s">"email"</span></code> - pole zostanie sprawdzone czy znajduję się w nim poprawny adres email. Dodatkowo, gdy ten atrybut jest ustawiony, na klawiaturach w urządzeniach mobilnych pojawi się symbol @, co jest dodatkowym ułatwieniem.</li>
  <li><code class="highlight"><span class="na">required</span></code> - określa, że pole nie może pozostać puste.</li>
</ul>

<p><span class="note">Gdy dla &#60;<span class="tag">input</span>&#62; nie zdefiniujemy atrybutu <span class="attr">type</span>, domyślnie jest to <span class="value">“text”</span>.</span></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;label&gt;</span>
Twój email
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"from"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Wpisz tu twój email"</span> <span class="na">required</span><span class="nt">&gt;</span>
<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;label&gt;</span>
Temat
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"subject"</span> <span class="na">placeholder=</span><span class="s">"Wpisz tu temat wiadomości"</span> <span class="na">required</span><span class="nt">&gt;</span>
<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"inp-message"</span><span class="nt">&gt;</span>
Treść
<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">id=</span><span class="s">"inp-message"</span> <span class="na">placeholder=</span><span class="s">"Wpisz tu twoją wiadomość"</span> <span class="na">required</span><span class="nt">&gt;&lt;/textarea&gt;</span></code></pre></figure>

<p>Od strony HTML to by było na tyle. Przejdźmy do JS/JQuery.</p>

<p>Przypominam, że we wcześniejszym poście pobraliśmy sobie wszystkie elementy formularza, na których teraz będziemy pracować:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">const</span> <span class="nx">userEmail</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s1">'from'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s1">'subject'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s1">'message'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">const</span> <span class="nx">recaptcha</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".g-recaptcha"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">formAlert</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".emailFormAlert"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">contactForm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#contact'</span><span class="p">);</span></code></pre></figure>

<p>Dodajemy obsługę zdarzenia - kliknięcie przycisku “Submit”:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">$</span><span class="p">(</span><span class="s1">'.emailFormSubmit'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">formAlert</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s1">'&lt;i class="fa fa-spinner fa-pulse fa-2x fa-fw"&gt;&lt;/i&gt;'</span><span class="p">;</span>
    <span class="c1">//reszta
</span>
  <span class="p">});</span></code></pre></figure>

<p>W funkcji anonimowej odbieramy to zdarzenie <code class="highlight"><span class="nx">event</span></code> i wywołujemy na nim metodę <code class="highlight language-javascript" data-lang="javascript"><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></code>, która zapobiega domyślnemu zachowaniu przycisku “submit”. Gdybyśmy tego nie zrobili to wykonałaby się wbudowana walidacja w HTML5, a po jej pomyślnym przejściu przeniosłoby nas do pliku <span class="file">emailform.php</span>, tak jak to określiliśmy w atrybucie <code class="highlight"><span class="na">action</span></code> w formularzu. Jest to coś dokładnie odwrotnego od tego, co byśmy chcieli, więc powstrzymujemy to i wykorzystamy AJAX, aby dostać odpowiedź z pliku <span class="file">emailform.php</span> bez przeładowania strony, zaraz pod naszym formularzem.</p>

<p><span class="note">
AJAX umożliwia wysyłanie i odbieranie danych z serwera w sposób asynchroniczny(w tle), bez potrzeby przeładowywania całej strony od nowa. Jest to podstawowa metoda tworzenia dynamicznych stron/aplikacji.
</span></p>

<p>Dodatkowo w następnej linii dodaję ikonkę, która będzie się pojawiać podczas przetwarzania formularza:<i class="fa fa-spinner fa-pulse fa-fw"></i>. Jednak nie zobaczysz jej teraz, bo walidacja po stronie JS jest wręcz natychmiastowa. Ujrzysz ją dopiero podczas wysyłania wiadomości, bo to trwa odrobinę dłużej.</p>

<p>Zanim zaczniemy pisać walidację pobierzemy jeszcze element z odpowiedzią reCAPTCHA:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">const</span> <span class="nx">recaptchaResponse</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"g-recaptcha-response"</span><span class="p">);</span></code></pre></figure>

<p>Do walidacji przygotujemy sobie dwie funkcje:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">function</span> <span class="nx">validateEmailForm</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">userEmail</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">valid</span><span class="o">===</span><span class="kc">false</span><span class="p">){</span>
      <span class="nx">markWrongInput</span><span class="p">(</span><span class="nx">userEmail</span><span class="p">,</span><span class="s2">"Podaj poprawny email!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">valueMissing</span><span class="p">){</span>
      <span class="nx">markWrongInput</span><span class="p">(</span><span class="nx">subject</span><span class="p">,</span><span class="s2">"Wpisz jakiś temat!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">valueMissing</span><span class="p">){</span>
      <span class="nx">markWrongInput</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="s2">"Pusta wiadomość? Napisz coś!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">){</span>
      <span class="nx">recaptcha</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'shake'</span><span class="p">);</span>
      <span class="nx">recaptcha</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'shake'</span><span class="p">);</span>
      <span class="nx">recaptcha</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'shake'</span><span class="p">)});</span>
      <span class="nx">formAlert</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">"Potwierdź, że nie jesteś robotem!"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span></code></pre></figure>

<ul>
  <li><code class="highlight language-javascript" data-lang="javascript"><span class="nx">element</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">valid</span></code> - Sprawdza, na podstawie walidacji HTML5, czy element jest prawidłowy. W naszym przypadku sprawdza poprawność maila, bo zadeklarowaliśmy <code class="highlight"><span class="na">type=</span><span class="s">"email"</span></code>.</li>
  <li><code class="highlight language-javascript" data-lang="javascript"><span class="nx">element</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">valueMissing</span></code> - Tu podobnie, sprawdza czy element zawierający atrybut <code class="highlight"><span class="na">required</span></code> nie jest pusty.</li>
  <li><code class="highlight language-javascript" data-lang="javascript"><span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span></code> - Ten warunek sprawdza czy zaznaczone jest pole reCAPTCHA. Jeśli długość odpowiedzi = 0 to nie jest zaznaczony.</li>
</ul>

<p>W każdym przypadku, jak pewnie zauwżyłeś, gdy któryś test zwraca “false” za pomocą drugiej funkcji pomocniczej <code class="highlight language-javascript" data-lang="javascript"><span class="nx">markWrongInput</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span><span class="s2">"Treść komunikatu"</span><span class="p">)</span></code> generujemy komunikat oraz zaznaczamy niepoprawne pole. Wygląda ona tak:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="kd">function</span> <span class="nx">markWrongInput</span><span class="p">(</span><span class="nx">wrongElement</span><span class="p">,</span><span class="nx">alert</span><span class="p">){</span>
    <span class="nx">formAlert</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="nx">alert</span><span class="p">;</span>
    <span class="nx">wrongElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'wrongInput'</span><span class="p">);</span>
    <span class="nx">wrongElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"focus"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'wrongInput'</span><span class="p">)});</span>
  <span class="p">}</span></code></pre></figure>

<p>Jest relatywnie prosta - zmienia treść komunikatu w elemencie “formAlert” i nadaje (i usuwa ją gdy element uzyska focus) klasę ze stylem “wrongInput”, który zawiera animację i wygląda tak:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.wrongInput</span> <span class="p">{</span>
  <span class="nl">background</span><span class="p">:</span> <span class="m">#fd4854</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">red</span><span class="p">;</span>
  <span class="nl">animation</span><span class="p">:</span> <span class="m">1s</span> <span class="n">shake</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.shake</span> <span class="p">{</span>
  <span class="nl">animation</span><span class="p">:</span> <span class="m">1s</span> <span class="n">shake</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@keyframes</span> <span class="n">shake</span> <span class="p">{</span>
   <span class="nt">0</span><span class="o">%,</span> <span class="nt">100</span><span class="o">%</span> <span class="p">{</span><span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">0</span><span class="p">);}</span> 
   <span class="nt">10</span><span class="o">%,</span> <span class="nt">30</span><span class="o">%,</span> <span class="nt">50</span><span class="o">%,</span> <span class="nt">70</span><span class="o">%,</span> <span class="nt">90</span><span class="o">%</span> <span class="p">{</span><span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">-5px</span><span class="p">);}</span> 
   <span class="nt">20</span><span class="o">%,</span> <span class="nt">40</span><span class="o">%,</span> <span class="nt">60</span><span class="o">%,</span> <span class="nt">80</span><span class="o">%</span> <span class="p">{</span><span class="nl">transform</span><span class="p">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">5px</span><span class="p">);}</span> 
<span class="p">}</span></code></pre></figure>

<p>Gdy wszystkie testy przejdą pomyślnie, to zwracana jest wartość “true”. Przypiszmy sobie odpowiedź tej funkcji do zmiennej (a w sumie stałej :O <a href="http://es6-features.org/#Constants">ES6</a>) tam gdzię obsługujemy przycisk “submit”:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">const</span> <span class="nx">isValid</span> <span class="o">=</span> <span class="nx">validateEmailForm</span><span class="p">();</span></code></pre></figure>

<p>Na jej podstawie zdecydujemy czy wysłać dane:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="k">if</span><span class="p">(</span><span class="nx">isValid</span><span class="o">===</span><span class="kc">true</span><span class="p">){</span>
    	<span class="c1">//tu pojawi się AJAX
</span>
    <span class="p">}</span></code></pre></figure>

<p>Ostatnim krokiem jest wykonanie żądania AJAX. JQuery strasznie ułatwia sprawę:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="kd">const</span> <span class="nx">sendEmail</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s2">"POST"</span><span class="p">,</span>
      <span class="na">url</span><span class="p">:</span> <span class="s2">"emailform.php"</span><span class="p">,</span>
      <span class="na">dataType</span> <span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'userEmail'</span> <span class="p">:</span> <span class="nx">userEmail</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="s1">'subject'</span> <span class="p">:</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="s1">'message'</span> <span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="s1">'g-recaptcha-response'</span> <span class="p">:</span> <span class="nx">recaptchaResponse</span><span class="p">.</span><span class="nx">value</span>
      <span class="p">}</span>
    <span class="p">});</span></code></pre></figure>

<ul>
  <li>Pierwsze dwa pola są oczywiste, już je omawiałem w pierwszym poście.</li>
  <li><code class="highlight language-javascript" data-lang="javascript"><span class="nx">dataType</span></code> określa format przekazywanych danych. W naszym przypadku będzie to json.</li>
  <li><code class="highlight language-javascript" data-lang="javascript"><span class="nx">data</span></code> - i tu właśnie w formacie json (w naszym przypadku obiekt {‘nazwa’ : wartość}) przekazujemy dane z formularza.</li>
</ul>

<p class="note">
Po tych samych zdefiniowanych nazwach (<code class="highlight"><span class="s">'userEmail'</span></code>, <code class="highlight"><span class="s">'subject'</span></code> itd.) odbierzemy odpowiadające im wartości w PHP.
</p>

<p>Pozostało nam tylko odebrać odpowiedź, która jest przechowywana w zmiennej “sendEmail”. I tak:
gdy coś się nie powiedzie w naszym pliku PHP (czyli wystąpi jakiś error) wyświetlimy komunikat + treść błędu:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">      <span class="nx">sendEmail</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">formAlert</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s1">'Coś poszło nie tak :( '</span><span class="o">+</span><span class="nx">error</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
      <span class="p">});</span></code></pre></figure>

<p>gdy wszystko wykona się poprawnie (walidacja nie musi się powieść, chodzi o to, że kod nie zawiera żadnego błędu) wyświetlimy wygenerowaną na podstawie naszego kodu PHP odpowiedź.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">      <span class="nx">sendEmail</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
        <span class="nx">formAlert</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
      <span class="p">})</span></code></pre></figure>

<p>Oto efekt końcowy:
<script async="" src="//jsfiddle.net/C0deboy/w0csm9y5/embed/result,js,html,css/dark/"></script></p>


      </div>
    </div>
  </div>

</article>

<div class="container no-print">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <hr>

      <ul class="pager">
        
        <li class="previous">
          <a class="box-effect" href="/dajsiepoznac2017/formularz-kontaktowy-HTML-JS"
             data-toggle="tooltip" data-animation="zoom" data-delay="50" title="Dodajemy formularz kontaktowy 1#"><i class="fa fa-arrow-left"
                                                                                           aria-hidden="true"></i>
            Poprzedni post</a>
        </li>
        
        
        <li class="next">
          <a class="box-effect" href="/dajsiepoznac2017/formularz-kontaktowy-php-swiftmailer"
             data-toggle="tooltip" data-animation="zoom" data-delay="50" title="Dodajemy formularz kontaktowy 3#">Następny post <i
              class="fa fa-arrow-right" aria-hidden="true"></i></a>
        </li>
        
      </ul>

      <div class="text-center">
    <p class="text-center">Jeśli uważasz, że to co robię jest przydatne, polub stronę bloga na Facebooku. Wrzucam tam m.in. informacje o nowych wpisach, o promocjach dla programistów i inne.</p>

    <div class="fb-page inline box-effect">
        <iframe
            src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Fdevcavepl&tabs&width=340&height=130&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=false&appId"></iframe>
    </div>
</div>

      <div class="recommended">
    <div class="box-effect books-ad ">
        <a href="https://jaki-jezyk-programowania.pl/ksiazki">
            <img src="/img/books.png" alt="książki"/>
            <h3>Zobacz polecane książki</h3>
        </a>
    </div>

    <div class="box-effect books-ad ">
        <a href="https://jaki-jezyk-programowania.pl/kursy">
            <img src="/img/video-courses.png" alt="video kursy"/>
            <h3>Zobacz polecane video kursy</h3>
        </a>
    </div>
</div>

      <hr>

      

<div id="disqus_thread"></div>
<script>
  const disqus_config = function () {
    this.page.url = "https://devcave.pl/dajsiepoznac2017/formularz-kontaktowy-walidacja-ajax";
    this.page.identifier = "/dajsiepoznac2017/formularz-kontaktowy-walidacja-ajax";
  };

  (function () { // DON'T EDIT BELOW THIS LINE
    const d = document, s = d.createElement('script');
    s.src = 'https://jaki-jezyk-programowania.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Włacz JavaScript w twojej przeglądarce, aby zobaczyć <a href="https://disqus.com/?ref_noscript"> komentarze by
    Disqus.</a></noscript>



    </div>
  </div>
</div>

<hr>

<script src="/promotion/promotion.js"></script>



<footer class="no-print">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center social-buttons">
                    <li>
                        <a class="main-btn" href="/feed.xml" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="RSS">
                            <i class="fa fa-rss fa-lg"></i>
                        </a>
                    </li>
                    <li>
                        <a class="main-btn" href="https://www.linkedin.com/in/marcin-lasota/" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="LinkedIn">
                            <i class="fa fa-linkedin-square" aria-hidden="true"></i>
                        </a>
                    </li>
                    <li>
                        <a class="main-btn" href="https://github.com/C0deboy" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="Github">
                            <i class="fa fa-github fa-lg"></i>
                        </a>
                    </li>
                    <li>
                        <a class="main-btn" href="mailto:lasota.marcinm@gmail.com" data-toggle="tooltip" data-animation="zoom" data-delay="50" title="lasota.marcinm@gmail.com">
                            <i class="fa fa-envelope fa-lg"></i>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright <i class="fa fa-copyright" aria-hidden="true"></i> devcave 2017 - 2018</p>
            </div>
        </div>
    </div>
</footer>

<script src="/dist/js/devcave.min.js"></script>




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90973428-2', 'auto');
  ga('send', 'pageview');

</script>




</body>

</html>
